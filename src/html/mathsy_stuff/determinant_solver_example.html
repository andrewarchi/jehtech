<!doctype html>
<html>
<head>
</head>

<body>	
	<input id="matrix-string" type="text"><input id="matrix-button" type="submit" value="Go...">
	<div id="matrix-container" style="width:100%; border: 1px solid gray">
	</div>

	<div id="matrix-messages" style="border:1px solid gray;">
	</div>

	<script>
		var mrows = null;
		var matrixDivs = null;
		var msgBox = document.getElementById("matrix-messages");

		function RemoveRowColFromMatrix(matrix, row2del, col2del)
		{
			var newMatrix = new Matrix(matrix.numRows-1, matrix.numCols-1);
			var drow = 0, dcol = 0;
			for (var row = 0; row < matrix.numRows; ++row)
			{
				if (row == row2del) { continue; }
				for (var col = 0; col < matrix.numCols; ++col)
				{
					if (col == col2del) { continue; }

					newMatrix.data[drow][dcol] = matrix[row][col];

					dcol += 1;
				}
				drow += 1;
			}

			return newMatrix;
		}

		// Construct and empty numRows x numCols matrix
		function Matrix(numRows, numCols)
		{
			this.numCols = numCols;
			this.numRows = numRows;
			this.data = new Array(numRows);
			for (var row = 0; row < numRows; ++row)
			{
				this.data[row] = new Array(numCols);
			}

			this.findBestRowColForDeterminantCalc = function() {
				var rowWithMostZeros = 0,
				    bestRowNumZeros  = 0,
				    colWithMostZeros = 0,
				    bestColNumZeros  = 0;

				if (this.numRows != this.numCols)
				{
					alert("Matrix now square");
					return;
				}

				// Find the row with the most zeros in it...
				for (var row = 0; row < this.numRows; ++row)
				{
					var numZeros = 0;
					for (var col = 0; col < this.numCols; ++col)
					{
						if (this.data[row][col] == 0)
						{
							numZeros += 1;
						}
					}

					if (numZeros > bestRowNumZeros)
					{
						bestRowNumZeros = numZeros;
						rowWithMostZeros = row;
					}
				}

				// Find the column with the most zeroes in it...
				for (var col = 0; col < this.numCols; ++col)
				{
					var numZeros = 0;
					for (var row = 0; row < this.numRows; ++row)
					{
						if (this.data[row][col] == 0)
						{
							numZeros += 1;
						}
					}

					if (numZeros > bestColNumZeros)
					{
						bestColNumZeros = numZeros;
						colWithMostZeros = col;
					}
				}

				var isRow = bestColNumZeros <= bestRowNumZeros;
				return { 
					isRow: isRow, 
					idxMostZeros: isRow ? rowWithMostZeros : colWithMostZeros
				};
			}
		}

		// Construct a matrix from a matlab-ish style string, e.g. " 1 2; 3 4" is the matrix
		// [1 2]
		// [3 4]
		Matrix.fromString = function(matrixStr)
		{
			// Convert the string representation of a matrix into an nxn array
			var matrixData = matrixStr.split(";");
			var numRows = matrixData.length;
			var numCols = 0;
			for (var row = 0; row < numRows; ++row)
			{
				matrixData[row] = matrixData[row].trim().split(/\s+/);
				if (row == 0)
				{
					numCols = matrixData[row].length;
				}
				else
				{
					if (numCols != matrixData[row].length)
					{
						alert("Matrix columns not of the same length");
						return;
					}
				}
			}

			for (var row = 0; row < numRows; ++row)
			{
				for (var col = 0; col < numCols; ++col)
				{
					matrixData[row][col] = Number(matrixData[row][col]);
				}
			}

			var matrix = new Matrix(numRows, numCols);
			matrix.data = matrixData;
			return matrix;
		}

		// Creates a div called holding enough divs to display the matrix in the browser
		function MatrixDiv(matrixObj, parent)
		{
			var maxWidth  = 0,
			    maxHeight = 0;

			this.matrixObj = matrixObj;
			this.containerDiv = document.createElement("div");
			this.matrixDivs = new Array(matrixObj.numRows);
			for (var i = 0; i < this.matrixDivs.length; i++) {
				this.matrixDivs[i] = new Array(matrixObj.numCols);
			}

			// Must be part of the document if we are to get widths and heihts
			parent.appendChild(this.containerDiv);

			for (var row = 0; row < matrixObj.numRows; ++row)
			{
				for (var col = 0; col < matrixObj.numCols; ++col)
				{
					var newDiv = document.createElement("div");
					var newTxt = document.createTextNode(matrixObj.data[row][col].toString());
					newDiv.appendChild(newTxt);
					newDiv.style.margin="5px";
					//newDiv.style.border = "1px solid blue";
					newDiv.style.float = "left";
					if (col == 0) { newDiv.style.clear = "both"; }

					this.matrixDivs[row][col] = newDiv;
					this.containerDiv.appendChild(newDiv);

					// Do this after adding to document so it has a width & height.
					if (newDiv.offsetWidth > maxWidth)   { maxWidth = newDiv.offsetWidth; }
					if (newDiv.offsetHeight > maxHeight) { maxHeight = newDiv.offsetHeight; }
				}
			}

			for (var row = 0; row < matrixObj.numRows; ++row)
			{
				for (var col = 0; col < matrixObj.numCols; ++col)
				{
					this.matrixDivs[row][col].style.width = maxWidth + "px";
				}
			}

			this.containerDiv.style.width = maxWidth * matrixObj.numCols + 100 + "px"; // TODO: FIXME: Perhaps boarder not included?
			this.containerDiv.style.height = maxHeight * matrixObj.numRows + 100 + "px";

			this.highlightRow = function(row, colour) {
				if (row >= this.numRows || row < 0) {
					alert("Bad row");
					return;
				}

				for (var col = 0; col < this.matrixObj.numCols; ++col)
				{
					this.matrixDivs[row][col].style.background = colour;
				}
			}

			this.highlightCol = function(col, colour) {
				if (col >= this.numCols || col < 0) {
					alert("Bad col");
					return;
				}

				for (var row = 0; row < this.matrixObj.numRows; ++row)
				{
					this.matrixDivs[row][col].style.background = colour;
				}
			}
		}

		function clear_all_matricies() {
			var mc = document.getElementById("matrix-container");
			// Kill off all child nodes
			while (mc.firstChild) {
	 		   mc.removeChild(mc.firstChild);
			}
		}

		function display_determinant_matrix() {
			var mstr = document.getElementById("matrix-string").value;
			var mc = document.getElementById("matrix-container");
			var msg = document.getElementById("matrix-messages");
			
			var matrix = Matrix.fromString(mstr);
			var matrixDiv = new MatrixDiv(matrix, mc);
			rowColInf = matrix.findBestRowColForDeterminantCalc();
			if (rowColInf.isRow) 
			{
				matrixDiv.highlightRow(rowColInf.idxMostZeros, "yellow");
				msg.innerHTML = "<p>The " + (rowColInf.idxMostZeros + 1) + "<sup>th</sup> row contains the most zeros so we will start there.</p>";
			}
			else
			{
				matrixDiv.highlightCol(rowColInf.idxMostZeros, "yellow");
				msg.innerHTML = "<p>The " + (rowColInf.idxMostZeros + 1) + "<sup>th</sup> column contains the most zeros so we will start there.</p>";
			}

			var detSign = function(i, j) {
				return ((i + j) % 2) == 0 ? "+" : "-";
			}

			msg.innerHTML += "<p>This means that the formula for the determinant becomes:</p>";
			if (rowColInf.isRow) {
				var formula = "";
				for (var col = 0; col < matrix.numCols; ++col)
				{
					var coeff = matrix.data[rowColInf.idxMostZeros][col];
					if (coeff != 0)
					{
						formula += detSign(rowColInf.idxMostZeros, col) + coeff.toString() + "|A<sub>" + rowColInf.idxMostZeros +"," + col + "</sub>| ";
					}
				}
				msg.innerHTML += "<p>" + formula + "</p>";
				msg.innerHTML  += "<p>Where...</p>";

				for (var col = 0; col < matrix.numCols; ++col)
				{
					var coeff = matrix.data[rowColInf.idxMostZeros][col];
					if (coeff != 0)
					{
						msg.innerHTML += "<p>A<sub>" + rowColInf.idxMostZeros +"," + col + "</sub> is A with row " + (rowColInf.idxMostZeros + 1) + ", column " + (col + 1) + " deleted.</p>";
						var subMatrix = RemoveRowColFromMatrix(rowColInf.idxMostZeros, col);
						//var subMatrixDiv = new MatrixDiv(subMatrix, mc);
					}
				}
			}
			else {

			}
		}

		var btn = document.getElementById("matrix-button");
		btn.onclick = display_determinant_matrix;
	</script>
</body>
</html>